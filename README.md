Basic implementation of a state machine
